{"version":3,"sources":["selection.js","selectionoverlay.js","selectionrect.js"],"names":["$","onOutsideDrag","e","this","viewer","setMouseNavEnabled","delta","viewport","deltaPointsFromPixels","end","pointFromPixel","position","start","Point","x","y","rect","oldRect","restrictToImage","clone","rectDone","allowRotation","angle1","getAngleFromCenter","angle2","rotation","Math","PI","startRotated","getPrerotatedRect","rotatedStartPoint","startRotatedHeight","width","height","bounds","world","getHomeBounds","fitsIn","Rect","pointIsInImage","restrictVector","SelectionRect","draw","onOutsideDragEnd","abs","onClick","originalEvent","target","tagName","toLowerCase","undraw","raiseEvent","canvas","focus","onInsideDrag","addClass","element","onInsideDragEnd","removeClass","onBorderDrag","border","center","getDegreeRotation","rotate","getCenter","newCenter","minus","onBorderDragEnd","onKeyPress","key","keyCode","charCode","confirm","String","fromCharCode","keyboardShortcut","toggleState","dist","distanceTo","angle","atan2","heightModDelta","self","point","prop","version","major","Error","Viewer","prototype","selection","options","selectionInstance","Selection","extend","isSelecting","buttonActiveImg","toggleButton","showSelectionControl","showConfirmDenyButtons","styleConfirmDenyButtons","returnPixelCoordinates","onSelection","prefixUrl","navImages","REST","GROUP","HOVER","DOWN","selectionConfirm","selectionCancel","borderStyle","color","handleStyle","top","left","margin","background","cornersStyle","makeNeutralElement","style","className","borders","handle","corners","i","MouseTracker","dragHandler","bind","dragEndHandler","appendChild","setTimeout","right","bottom","overlay","SelectionOverlay","innerTracker","clickTimeThreshold","clickDistThreshold","delegate","clickHandler","outerTracker","startDisabled","addEvent","container","prefix","useGroup","buttons","anyButton","onFocusHandler","onFocus","onBlurHandler","onBlur","Button","getElement","tooltip","getString","srcRest","srcGroup","srcHover","srcDown","onRelease","push","imgDown","cloneNode","confirmButton","classList","add","cancelButton","cancel","transform","addHandler","ControlDock","setState","enabled","setTracking","visibility","setAllowRotation","enable","disable","update","normalize","drawHTML","drawer","highlight","document","createElement","location","imageToViewportRectangle","OpenSeadragon","addOverlay","destroy","result","real","viewportToImageRectangle","fromRect","round","Overlay","apply","arguments","isPlainObject","Object","create","replace","equals","other","toString","swapWidthHeight","swapped","diff","fixed","area","getTopLeft","getTopRight","getBottomRight","getBottomLeft","areaEnd","reduceRotation","reduced"],"mappings":"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","file":"openseadragonselection.js","sourcesContent":["(function($) {\n    'use strict';\n\n    if (!$.version || $.version.major < 2) {\n        throw new Error('This version of OpenSeadragonSelection requires OpenSeadragon version 2.0.0+');\n    }\n\n    $.Viewer.prototype.selection = function(options) {\n        if (!this.selectionInstance || options) {\n            options = options || {};\n            options.viewer = this;\n            this.selectionInstance = new $.Selection(options);\n        }\n        return this.selectionInstance;\n    };\n\n\n    /**\n    * @class Selection\n    * @classdesc Provides functionality for selecting part of an image\n    * @memberof OpenSeadragon\n    * @param {Object} options\n    */\n    $.Selection = function ( options ) {\n\n        $.extend( true, this, {\n            // internal state properties\n            viewer:                  null,\n            isSelecting:             false,\n            buttonActiveImg:         false,\n            rectDone:                true,\n\n            // options\n            element:                 null,\n            toggleButton:            null,\n            showSelectionControl:    true,\n            showConfirmDenyButtons:  true,\n            styleConfirmDenyButtons: true,\n            returnPixelCoordinates:  true,\n            keyboardShortcut:        'c',\n            rect:                    null,\n            allowRotation:           true,\n            startRotated:            false, // useful for rotated crops\n            startRotatedHeight:      0.1,\n            restrictToImage:         false,\n            onSelection:             null,\n            prefixUrl:               null,\n            navImages:               {\n                selection: {\n                    REST:   'selection_rest.png',\n                    GROUP:  'selection_grouphover.png',\n                    HOVER:  'selection_hover.png',\n                    DOWN:   'selection_pressed.png'\n                },\n                selectionConfirm: {\n                    REST:   'selection_confirm_rest.png',\n                    GROUP:  'selection_confirm_grouphover.png',\n                    HOVER:  'selection_confirm_hover.png',\n                    DOWN:   'selection_confirm_pressed.png'\n                },\n                selectionCancel: {\n                    REST:   'selection_cancel_rest.png',\n                    GROUP:  'selection_cancel_grouphover.png',\n                    HOVER:  'selection_cancel_hover.png',\n                    DOWN:   'selection_cancel_pressed.png'\n                },\n            },\n            borderStyle: {\n                width:      '1px',\n                color:      '#fff'\n            },\n            handleStyle: {\n                top:        '50%',\n                left:       '50%',\n                width:      '6px',\n                height:     '6px',\n                margin:     '-4px 0 0 -4px',\n                background: '#000',\n                border:     '1px solid #ccc'\n            },\n            cornersStyle: {\n                width:      '6px',\n                height:     '6px',\n                background: '#000',\n                border:     '1px solid #ccc'\n            }\n\n        }, options );\n\n        $.extend( true, this.navImages, this.viewer.navImages );\n\n        if (!this.element) {\n            this.element = $.makeNeutralElement('div');\n            this.element.style.background = 'rgba(0, 0, 0, 0.1)';\n            this.element.className        = 'selection-box';\n        }\n        this.borders = this.borders || [];\n        var handle;\n        var corners = [];\n        for (var i = 0; i < 4; i++) {\n            if (!this.borders[i]) {\n                this.borders[i]                  = $.makeNeutralElement('div');\n                this.borders[i].className        = 'border-' + i;\n                this.borders[i].style.position   = 'absolute';\n                this.borders[i].style.width      = this.borderStyle.width;\n                this.borders[i].style.height     = this.borderStyle.width;\n                this.borders[i].style.background = this.borderStyle.color;\n            }\n\n            handle                  = $.makeNeutralElement('div');\n            handle.className        = 'border-' + i + '-handle';\n            handle.style.position   = 'absolute';\n            handle.style.top        = this.handleStyle.top;\n            handle.style.left       = this.handleStyle.left;\n            handle.style.width      = this.handleStyle.width;\n            handle.style.height     = this.handleStyle.height;\n            handle.style.margin     = this.handleStyle.margin;\n            handle.style.background = this.handleStyle.background;\n            handle.style.border     = this.handleStyle.border;\n            new $.MouseTracker({\n                element:     this.borders[i],\n                dragHandler: onBorderDrag.bind(this, i),\n                dragEndHandler: onBorderDragEnd.bind(this, i),\n            });\n\n            corners[i]                  = $.makeNeutralElement('div');\n            corners[i].className        = 'corner-' + i + '-handle';\n            corners[i].style.position   = 'absolute';\n            corners[i].style.width      = this.cornersStyle.width;\n            corners[i].style.height     = this.cornersStyle.height;\n            corners[i].style.background = this.cornersStyle.background;\n            corners[i].style.border     = this.cornersStyle.border;\n            new $.MouseTracker({\n                element:     corners[i],\n                dragHandler: onBorderDrag.bind(this, i + 0.5),\n                dragEndHandler: onBorderDragEnd.bind(this, i),\n            });\n\n            this.borders[i].appendChild(handle);\n            this.element.appendChild(this.borders[i]);\n            // defer corners, so they are appended last\n            setTimeout(this.element.appendChild.bind(this.element, corners[i]), 0);\n        }\n        this.borders[0].style.top = 0;\n        this.borders[0].style.width = '100%';\n        this.borders[1].style.right = 0;\n        this.borders[1].style.height = '100%';\n        this.borders[2].style.bottom = 0;\n        this.borders[2].style.width = '100%';\n        this.borders[3].style.left = 0;\n        this.borders[3].style.height = '100%';\n        corners[0].style.top = '-3px';\n        corners[0].style.left = '-3px';\n        corners[1].style.top = '-3px';\n        corners[1].style.right = '-3px';\n        corners[2].style.bottom = '-3px';\n        corners[2].style.right = '-3px';\n        corners[3].style.bottom = '-3px';\n        corners[3].style.left = '-3px';\n\n        if (!this.overlay) {\n            this.overlay = new $.SelectionOverlay(this.element, this.rect || new $.SelectionRect());\n        }\n\n        this.innerTracker = new $.MouseTracker({\n            element:            this.element,\n            clickTimeThreshold: this.viewer.clickTimeThreshold,\n            clickDistThreshold: this.viewer.clickDistThreshold,\n            dragHandler:        $.delegate( this, onInsideDrag ),\n            dragEndHandler:     $.delegate( this, onInsideDragEnd ),\n            // keyHandler:         $.delegate( this, onKeyPress ),\n            clickHandler:       $.delegate( this, onClick ),\n            // scrollHandler:      $.delegate( this.viewer, this.viewer.innerTracker.scrollHandler ),\n            // pinchHandler:       $.delegate( this.viewer, this.viewer.innerTracker.pinchHandler ),\n        });\n\n        this.outerTracker = new $.MouseTracker({\n            element:            this.viewer.canvas,\n            clickTimeThreshold: this.viewer.clickTimeThreshold,\n            clickDistThreshold: this.viewer.clickDistThreshold,\n            dragHandler:        $.delegate( this, onOutsideDrag ),\n            dragEndHandler:     $.delegate( this, onOutsideDragEnd ),\n            clickHandler:       $.delegate( this, onClick ),\n            startDisabled:      !this.isSelecting,\n        });\n\n        if (this.keyboardShortcut) {\n            $.addEvent(\n                this.viewer.container,\n                'keypress',\n                $.delegate(this, onKeyPress),\n                false\n            );\n        }\n\n        var prefix = this.prefixUrl || this.viewer.prefixUrl || '';\n        var useGroup = this.viewer.buttons && this.viewer.buttons.buttons;\n        var anyButton = useGroup ? this.viewer.buttons.buttons[0] : null;\n        var onFocusHandler = anyButton ? anyButton.onFocus : null;\n        var onBlurHandler = anyButton ? anyButton.onBlur : null;\n        if (this.showSelectionControl) {\n            this.toggleButton = new $.Button({\n                element:    this.toggleButton ? $.getElement( this.toggleButton ) : null,\n                clickTimeThreshold: this.viewer.clickTimeThreshold,\n                clickDistThreshold: this.viewer.clickDistThreshold,\n                tooltip:    $.getString('Tooltips.SelectionToggle') || 'Toggle selection',\n                srcRest:    prefix + this.navImages.selection.REST,\n                srcGroup:   prefix + this.navImages.selection.GROUP,\n                srcHover:   prefix + this.navImages.selection.HOVER,\n                srcDown:    prefix + this.navImages.selection.DOWN,\n                onRelease:  this.toggleState.bind( this ),\n                onFocus:    onFocusHandler,\n                onBlur:     onBlurHandler\n            });\n            if (useGroup) {\n                this.viewer.buttons.buttons.push(this.toggleButton);\n                this.viewer.buttons.element.appendChild(this.toggleButton.element);\n            }\n            if (this.toggleButton.imgDown) {\n                this.buttonActiveImg = this.toggleButton.imgDown.cloneNode(true);\n                this.toggleButton.element.appendChild(this.buttonActiveImg);\n            }\n        }\n        if (this.showConfirmDenyButtons) {\n            this.confirmButton = new $.Button({\n                element:    this.confirmButton ? $.getElement( this.confirmButton ) : null,\n                clickTimeThreshold: this.viewer.clickTimeThreshold,\n                clickDistThreshold: this.viewer.clickDistThreshold,\n                tooltip:    $.getString('Tooltips.SelectionConfirm') || 'Confirm selection',\n                srcRest:    prefix + this.navImages.selectionConfirm.REST,\n                srcGroup:   prefix + this.navImages.selectionConfirm.GROUP,\n                srcHover:   prefix + this.navImages.selectionConfirm.HOVER,\n                srcDown:    prefix + this.navImages.selectionConfirm.DOWN,\n                onRelease:  this.confirm.bind( this ),\n                onFocus:    onFocusHandler,\n                onBlur:     onBlurHandler\n            });\n            var confirm = this.confirmButton.element;\n            confirm.classList.add('confirm-button');\n            this.element.appendChild(confirm);\n\n            this.cancelButton = new $.Button({\n                element:    this.cancelButton ? $.getElement( this.cancelButton ) : null,\n                clickTimeThreshold: this.viewer.clickTimeThreshold,\n                clickDistThreshold: this.viewer.clickDistThreshold,\n                tooltip:    $.getString('Tooltips.SelectionCancel') || 'Cancel selection',\n                srcRest:    prefix + this.navImages.selectionCancel.REST,\n                srcGroup:   prefix + this.navImages.selectionCancel.GROUP,\n                srcHover:   prefix + this.navImages.selectionCancel.HOVER,\n                srcDown:    prefix + this.navImages.selectionCancel.DOWN,\n                onRelease:  this.cancel.bind( this ),\n                onFocus:    onFocusHandler,\n                onBlur:     onBlurHandler\n            });\n            var cancel = this.cancelButton.element;\n            cancel.classList.add('cancel-button');\n            this.element.appendChild(cancel);\n\n            if (this.styleConfirmDenyButtons) {\n                confirm.style.position = 'absolute';\n                confirm.style.top = '50%';\n                confirm.style.left = '50%';\n                confirm.style.transform = 'translate(-100%, -50%)';\n\n                cancel.style.position = 'absolute';\n                cancel.style.top = '50%';\n                cancel.style.left = '50%';\n                cancel.style.transform = 'translate(0, -50%)';\n            }\n        }\n\n        this.viewer.addHandler('selection', this.onSelection);\n\n        this.viewer.addHandler('open', this.draw.bind(this));\n        this.viewer.addHandler('animation', this.draw.bind(this));\n        this.viewer.addHandler('resize', this.draw.bind(this));\n        this.viewer.addHandler('rotate', this.draw.bind(this));\n    };\n\n    $.extend( $.Selection.prototype, $.ControlDock.prototype, /** @lends OpenSeadragon.Selection.prototype */{\n\n        toggleState: function() {\n            return this.setState(!this.isSelecting);\n        },\n\n        setState: function(enabled) {\n            this.isSelecting = enabled;\n            // this.viewer.innerTracker.setTracking(!enabled);\n            this.outerTracker.setTracking(enabled);\n            enabled ? this.draw() : this.undraw();\n            if (this.buttonActiveImg) {\n                this.buttonActiveImg.style.visibility = enabled ? 'visible' : 'hidden';\n            }\n            this.viewer.raiseEvent('selection_toggle', {enabled: enabled});\n            return this;\n        },\n\n        setAllowRotation: function(allowRotation) {\n            this.allowRotation = allowRotation;\n        },\n\n        enable: function() {\n            return this.setState(true);\n        },\n\n        disable: function() {\n            return this.setState(false);\n        },\n\n        draw: function() {\n            if (this.rect) {\n                this.overlay.update(this.rect.normalize());\n                this.overlay.drawHTML(this.viewer.drawer.container, this.viewer.viewport);\n                this.confirm();\n            }\n            return this;\n        },\n\n        highlight: function(rect) {\n            var element = document.createElement('div');\n            element.className = 'openseadragon-overlay';\n            var location = this.viewer.viewport.imageToViewportRectangle(\n                new OpenSeadragon.Rect(rect.x, rect.y, rect.width, rect.height));\n            this.viewer.addOverlay(element, location);\n            return element;\n        },\n\n        undraw: function() {\n            this.overlay.destroy();\n            this.rect = null;\n            return this;\n        },\n\n        confirm: function() {\n            if (this.rect) {\n                var result = this.rect.normalize();\n                if (this.returnPixelCoordinates) {\n                    var real = this.viewer.viewport.viewportToImageRectangle(result);\n                    real = $.SelectionRect.fromRect(real).round();\n                    real.rotation = result.rotation;\n                    result = real;\n                }\n                this.viewer.raiseEvent('selection', result);\n                // this.undraw();\n            }\n            return this;\n        },\n\n        cancel: function() {\n            /*\n             * These two lines have been added to fix a issue with mobile where the selection is just a pinpoint after the first drag\n             * For some reason disabling then re-enabling the tracking fixes this issue.\n             */\n            this.outerTracker.setTracking(false);\n            this.outerTracker.setTracking(true);\n            this.viewer.raiseEvent('selection_cancel', false);\n            return this.undraw();\n        },\n    });\n\n    function onOutsideDrag(e) {\n        // Disable move when makeing new selection\n        this.viewer.setMouseNavEnabled(false);\n        var delta = this.viewer.viewport.deltaPointsFromPixels(e.delta, true);\n        var end = this.viewer.viewport.pointFromPixel(e.position, true);\n        var start = new $.Point(end.x - delta.x, end.y - delta.y);\n        if (!this.rect) {\n            if (this.restrictToImage) {\n                if (!pointIsInImage(this, start)) {\n                    return;\n                }\n                restrictVector(delta, end);\n            }\n            if (this.startRotated) {\n                this.rotatedStartPoint = start;\n                this.rect = getPrerotatedRect(start, end, this.startRotatedHeight);\n            } else {\n                this.rect = new $.SelectionRect(start.x, start.y, delta.x, delta.y);\n            }\n            this.rectDone = false;\n        } else {\n            var oldRect;\n            if (this.restrictToImage) {\n                oldRect = this.rect.clone();\n            }\n            if (this.rectDone) {\n                // All rotation as needed.\n                if (this.allowRotation) {\n                    var angle1 = this.rect.getAngleFromCenter(start);\n                    var angle2 = this.rect.getAngleFromCenter(end);\n                    this.rect.rotation = (this.rect.rotation + angle1 - angle2) % Math.PI;\n                }\n            } else {\n                if (this.startRotated) {\n                    this.rect = getPrerotatedRect(this.rotatedStartPoint, end, this.startRotatedHeight);\n                } else {\n                    this.rect.width += delta.x;\n                    this.rect.height += delta.y;\n                }\n            }\n            var bounds = this.viewer.world.getHomeBounds();\n            if (this.restrictToImage && !this.rect.fitsIn(new $.Rect(0, 0, bounds.width, bounds.height))) {\n                this.rect = oldRect;\n            }\n        }\n        this.draw();\n    }\n\n    function onOutsideDragEnd() {\n        // Resizing a selection will function\n        // when drawn any direction\n        if (this.rect.width < 0){\n            this.rect.x += this.rect.width;\n            this.rect.width = Math.abs(this.rect.width);\n        }\n        if (this.rect.height < 0){\n            this.rect.y += this.rect.height;\n            this.rect.height = Math.abs(this.rect.height);\n        }\n        \n        // Eable move after new selection is done\n        this.viewer.setMouseNavEnabled(true);\n        this.rectDone = true;\n    }\n\n    function onClick(e) {\n        if (e.originalEvent.target.tagName.toLowerCase() === 'canvas') {\n          this.undraw();\n          this.viewer.raiseEvent('selection', null);\n        }\n        this.viewer.canvas.focus();\n    }\n\n    function onInsideDrag(e) {\n        $.addClass(this.element, 'dragging');\n        var delta = this.viewer.viewport.deltaPointsFromPixels(e.delta, true);\n        this.rect.x += delta.x;\n        this.rect.y += delta.y;\n        var bounds = this.viewer.world.getHomeBounds();\n        if (this.restrictToImage && !this.rect.fitsIn(new $.Rect(0, 0, bounds.width, bounds.height))) {\n            this.rect.x -= delta.x;\n            this.rect.y -= delta.y;\n        }\n        this.draw();\n    }\n\n    function onInsideDragEnd() {\n        $.removeClass(this.element, 'dragging');\n    }\n\n    function onBorderDrag(border, e) {\n        var delta = e.delta;\n        var rotation = this.rect.getDegreeRotation();\n        var center;\n        var oldRect = this.restrictToImage ? this.rect.clone() : null;\n        if (rotation !== 0) {\n            // adjust vector\n            delta = delta.rotate(-1 * rotation, new $.Point(0, 0));\n            center = this.rect.getCenter();\n        }\n        delta = this.viewer.viewport.deltaPointsFromPixels(delta, true);\n        switch (border) {\n            case 0:\n                this.rect.y += delta.y;\n                this.rect.height -= delta.y;\n                break;\n            case 1:\n                this.rect.width += delta.x;\n                break;\n            case 2:\n                this.rect.height += delta.y;\n                break;\n            case 3:\n                this.rect.x += delta.x;\n                this.rect.width -= delta.x;\n                break;\n            case 0.5:\n                this.rect.y += delta.y;\n                this.rect.height -= delta.y;\n                this.rect.x += delta.x;\n                this.rect.width -= delta.x;\n                break;\n            case 1.5:\n                this.rect.y += delta.y;\n                this.rect.height -= delta.y;\n                this.rect.width += delta.x;\n                break;\n            case 2.5:\n                this.rect.width += delta.x;\n                this.rect.height += delta.y;\n                break;\n            case 3.5:\n                this.rect.height += delta.y;\n                this.rect.x += delta.x;\n                this.rect.width -= delta.x;\n                break;\n        }\n        if (rotation !== 0) {\n            // calc center deviation\n            var newCenter = this.rect.getCenter();\n            // rotate new center around old\n            var target = newCenter.rotate(rotation, center);\n            // adjust new center\n            delta = target.minus(newCenter);\n            this.rect.x += delta.x;\n            this.rect.y += delta.y;\n        }\n        var bounds = this.viewer.world.getHomeBounds();\n        if (this.restrictToImage && !this.rect.fitsIn(new $.Rect(0, 0, bounds.width, bounds.height))) {\n            this.rect = oldRect;\n        }\n        this.draw();\n    }\n    \n    // After you have completed dragging, ensure the top left of the selection\n    // box is still the top left corner of the box\n    function onBorderDragEnd(){\n        if (this.rect.width < 0){\n            this.rect.x += this.rect.width;\n            this.rect.width = Math.abs(this.rect.width);\n        }\n        if (this.rect.height < 0){\n            this.rect.y += this.rect.height;\n            this.rect.height = Math.abs(this.rect.height);\n        }\n    }\n\n    function onKeyPress(e) {\n        var key = e.keyCode ? e.keyCode : e.charCode;\n        if (key === 13) {\n            this.confirm();\n        } else if (String.fromCharCode(key) === this.keyboardShortcut) {\n            this.toggleState();\n        }\n    }\n\n    function getPrerotatedRect(start, end, height) {\n        if (start.x > end.x) {\n            // always draw left to right\n            var x = start;\n            start = end;\n            end = x;\n        }\n        var delta = end.minus(start);\n        var dist = start.distanceTo(end);\n        var angle = -1 * Math.atan2(delta.x, delta.y) + (Math.PI / 2);\n        var center = new $.Point(\n            delta.x / 2 + start.x,\n            delta.y / 2 + start.y\n        );\n        var rect = new $.SelectionRect(\n            center.x - (dist / 2),\n            center.y - (height / 2),\n            dist,\n            height,\n            angle\n        );\n        var heightModDelta = new $.Point(0, height);\n        heightModDelta = heightModDelta.rotate(rect.getDegreeRotation(), new $.Point(0, 0));\n        rect.x += heightModDelta.x / 2;\n        rect.y += heightModDelta.y / 2;\n        return rect;\n    }\n\n    function pointIsInImage(self, point) {\n        var bounds = self.viewer.world.getHomeBounds();\n        return point.x >= 0 && point.x <= bounds.width && point.y >= 0 && point.y <= bounds.height;\n    }\n\n    function restrictVector(delta, end) {\n        var start;\n        for (var prop in {x: 0, y: 0}) {\n            start = end[prop] - delta[prop];\n            if (start < 1 && start > 0) {\n                if (end[prop] > 1) {\n                    delta[prop] -= end[prop] - 1;\n                    end[prop] = 1;\n                } else if (end[prop] < 0) {\n                    delta[prop] -= end[prop];\n                    end[prop] = 0;\n                }\n            }\n        }\n    }\n\n})(OpenSeadragon);\n","(function( $ ){\n    'use strict';\n\n    /**\n     * @class Overlay\n     * @classdesc Provides a way to float an HTML element on top of the viewer element.\n     *\n     * @memberof OpenSeadragon\n     * @param {Object} options\n     * @param {Element} options.element\n     * @param {OpenSeadragon.Point|OpenSeadragon.Rect|OpenSeadragon.SelectionRect} options.location - The\n     * location of the overlay on the image. If a {@link OpenSeadragon.Point}\n     * is specified, the overlay will keep a constant size independently of the\n     * zoom. If a {@link OpenSeadragon.Rect} is specified, the overlay size will\n     * be adjusted when the zoom changes.\n     * @param {OpenSeadragon.OverlayPlacement} [options.placement=OpenSeadragon.OverlayPlacement.TOP_LEFT]\n     * Relative position to the viewport.\n     * Only used if location is a {@link OpenSeadragon.Point}.\n     * @param {OpenSeadragon.Overlay.OnDrawCallback} [options.onDraw]\n     * @param {Boolean} [options.checkResize=true] Set to false to avoid to\n     * check the size of the overlay everytime it is drawn when using a\n     * {@link OpenSeadragon.Point} as options.location. It will improve\n     * performances but will cause a misalignment if the overlay size changes.\n     */\n    $.SelectionOverlay = function( element, location) {\n        $.Overlay.apply( this, arguments );\n\n        // set the rotation in radians\n        if ( $.isPlainObject( element ) ) {\n            this.rotation = element.location.rotation || 0;\n        } else {\n            this.rotation = location.rotation || 0;\n        }\n    };\n\n    $.SelectionOverlay.prototype = $.extend( Object.create($.Overlay.prototype), {\n\n        /**\n         * @function\n         * @param {Element} container\n         */\n        drawHTML: function() {\n            $.Overlay.prototype.drawHTML.apply( this, arguments );\n            this.style.transform = this.style.transform.replace(/ ?rotate\\(.+rad\\)/, '') +\n                ' rotate(' + this.rotation + 'rad)';\n        },\n\n        /**\n         * @function\n         * @param {OpenSeadragon.Point|OpenSeadragon.Rect} location\n         * @param {OpenSeadragon.OverlayPlacement} position\n         */\n        update: function( location ) {\n            $.Overlay.prototype.update.apply( this, arguments );\n            this.rotation = location.rotation || 0;\n        }\n    });\n\n}( OpenSeadragon ));\n","(function( $ ){\n    'use strict';\n\n    /**\n     * @class SelectionRect\n     * @classdesc A display rectangle is very similar to {@link OpenSeadragon.Rect} but adds rotation\n     * around the center point\n     *\n     * @memberof OpenSeadragon\n     * @extends OpenSeadragon.Rect\n     * @param {Number} x The vector component 'x'.\n     * @param {Number} y The vector component 'y'.\n     * @param {Number} width The vector component 'height'.\n     * @param {Number} height The vector component 'width'.\n     * @param {Number} rotation The rotation in radians\n     */\n    $.SelectionRect = function( x, y, width, height, rotation ) {\n        $.Rect.apply( this, [ x, y, width, height ] );\n\n        /**\n         * The rotation in radians\n         * @member {Number} rotation\n         * @memberof OpenSeadragon.SelectionRect#\n         */\n        this.rotation = rotation || 0;\n    };\n\n    $.SelectionRect.fromRect = function(rect) {\n        return new $.SelectionRect(\n            rect.x,\n            rect.y,\n            rect.width,\n            rect.height\n        );\n    };\n\n    $.SelectionRect.prototype = $.extend( Object.create($.Rect.prototype), {\n\n        /**\n         * @function\n         * @returns {OpenSeadragon.Rect} a duplicate of this Rect\n         */\n        clone: function() {\n            return new $.SelectionRect(this.x, this.y, this.width, this.height, this.rotation);\n        },\n\n        /**\n         * Determines if two Rectangles have equivalent components.\n         * @function\n         * @param {OpenSeadragon.Rect} rectangle The Rectangle to compare to.\n         * @return {Boolean} 'true' if all components are equal, otherwise 'false'.\n         */\n        equals: function( other ) {\n            return $.Rect.prototype.equals.apply(this, [ other ]) &&\n                ( this.rotation === other.rotation );\n        },\n\n        /**\n         * Provides a string representation of the rectangle which is useful for\n         * debugging.\n         * @function\n         * @returns {String} A string representation of the rectangle.\n         */\n        toString: function() {\n            return '[' +\n                (Math.round(this.x*100) / 100) + ',' +\n                (Math.round(this.y*100) / 100) + ',' +\n                (Math.round(this.width*100) / 100) + 'x' +\n                (Math.round(this.height*100) / 100) + '@' +\n                (Math.round(this.rotation*100) / 100) +\n            ']';\n        },\n\n        swapWidthHeight: function() {\n            var swapped = this.clone();\n            swapped.width = this.height;\n            swapped.height = this.width;\n            swapped.x += (this.width - this.height) / 2;\n            swapped.y += (this.height - this.width) / 2;\n            return swapped;\n        },\n\n        /**\n         * @function\n         * @returns {Number} The rotaion in degrees\n         */\n        getDegreeRotation: function() {\n            return this.rotation * (180/Math.PI);\n        },\n\n        /**\n         * @function\n         * @param {OpenSeadragon.Point} point\n         * @returns {Number} The angle in radians\n         */\n        getAngleFromCenter: function(point) {\n            var diff = point.minus(this.getCenter());\n            return Math.atan2(diff.x, diff.y);\n        },\n\n        /**\n         * Rounds pixel coordinates\n         * @function\n         * @returns {SelectionRect} The altered rect\n         */\n        round: function() {\n            return new $.SelectionRect(\n                Math.round(this.x),\n                Math.round(this.y),\n                Math.round(this.width),\n                Math.round(this.height),\n                this.rotation\n            );\n        },\n\n        /**\n         * Fixes negative width/height, rotation larger than PI\n         * @function\n         * @returns {SelectionRect} The normalized rect\n         */\n        normalize: function() {\n            var fixed = this.clone();\n            if (fixed.width < 0) {\n                fixed.x += fixed.width;\n                fixed.width *= -1;\n            }\n            if (fixed.height < 0) {\n                fixed.y += fixed.height;\n                fixed.height *= -1;\n            }\n            fixed.rotation %= Math.PI;\n            return fixed;\n        },\n\n        /**\n         * @function\n         * @param {OpenSeadragon.Rect} area\n         * @returns {Boolean} Does this rect fit in a specified area\n         */\n        fitsIn: function(area) {\n            var rect = this.normalize();\n            var corners = [\n                rect.getTopLeft(),\n                rect.getTopRight(),\n                rect.getBottomRight(),\n                rect.getBottomLeft(),\n            ];\n            var center = rect.getCenter();\n            var rotation = rect.getDegreeRotation();\n            var areaEnd = area.getBottomRight();\n            for (var i = 0; i < 4; i++) {\n                corners[i] = corners[i].rotate(rotation, center);\n                if (corners[i].x < area.x || corners[i].x > areaEnd.x ||\n                    corners[i].y < area.y || corners[i].y > areaEnd.y) {\n                    return false;\n                }\n            }\n            return true;\n        },\n\n        /**\n         * Reduces rotation to within [-45, 45] degrees by swapping width & height\n         * @function\n         * @returns {SelectionRect} The altered rect\n         */\n        reduceRotation: function() {\n            var reduced;\n            if (this.rotation < Math.PI / (-4)) {\n                reduced = this.swapWidthHeight();\n                reduced.rotation += Math.PI / 2;\n            } else if (this.rotation > Math.PI / 4) {\n                reduced = this.swapWidthHeight();\n                reduced.rotation -= Math.PI / 2;\n            } else {\n                reduced = this.clone();\n            }\n            return reduced;\n        },\n    });\n\n}( OpenSeadragon ));\n"]}